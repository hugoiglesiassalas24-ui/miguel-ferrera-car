<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Miguel Ferrera Drift</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #111;
  font-family: Arial, sans-serif;
}

canvas {
  width: 100vw;
  height: 100vh;
  display: block;
}

.watermark {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 64px;
  font-weight: bold;
  color: rgba(255,255,255,0.05);
  pointer-events: none;
  user-select: none;
}
</style>
</head>

<body>

<div class="watermark">Miguel Ferrera Drift</div>
<canvas id="game"></canvas>

<script>
/* ============ CANVAS ============ */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ============ IMÃGENES ============ */
const carImg = new Image();
carImg.src = "https://i.imgur.com/6rKcJ1y.png"; // coche realista top-down

const roadPattern = new Image();
roadPattern.src = "https://i.imgur.com/l5J2FzM.png"; // asfalto

/* ============ COCHE ============ */
const car = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  angle: 0,
  speed: 0,
  maxSpeed: 8,
  drift: 0.94
};

let keys = {};
let score = 0;

/* ============ CONTROLES ============ */
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

document.addEventListener("touchstart", e => {
  if (e.touches[0].clientX < window.innerWidth / 2) keys["ArrowLeft"] = true;
  else keys["ArrowRight"] = true;
});

document.addEventListener("touchend", () => {
  keys["ArrowLeft"] = false;
  keys["ArrowRight"] = false;
});

/* ============ UPDATE ============ */
function update() {

  if (keys["ArrowUp"]) car.speed += 0.2;
  else car.speed *= 0.98;

  car.speed = Math.min(car.speed, car.maxSpeed);

  if (keys["ArrowLeft"]) car.angle -= 0.05;
  if (keys["ArrowRight"]) car.angle += 0.05;

  // Movimiento con derrape
  car.x += Math.cos(car.angle) * car.speed;
  car.y += Math.sin(car.angle) * car.speed;

  car.speed *= car.drift;

  // Puntos por derrape
  if ((keys["ArrowLeft"] || keys["ArrowRight"]) && car.speed > 4) {
    score += 1;
  }

  // Mantener en pantalla
  if (car.x < 0) car.x = canvas.width;
  if (car.x > canvas.width) car.x = 0;
  if (car.y < 0) car.y = canvas.height;
  if (car.y > canvas.height) car.y = 0;
}

/* ============ DRAW ============ */
function draw() {

  // Fondo asfalto
  if (roadPattern.complete) {
    const pattern = ctx.createPattern(roadPattern, "repeat");
    ctx.fillStyle = pattern;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  } else {
    ctx.fillStyle = "#333";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  // Coche
  ctx.save();
  ctx.translate(car.x, car.y);
  ctx.rotate(car.angle);
  ctx.drawImage(carImg, -32, -16, 64, 32);
  ctx.restore();

  // HUD
  ctx.fillStyle = "#fff";
  ctx.font = "22px Arial";
  ctx.fillText("Drift points: " + score, 20, 40);
}

/* ============ LOOP ============ */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
